<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta http-equiv="CONTENT-TYPE" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.76 [en] (X11; U; SunOS 5.8 sun4u) [Netscape]">
   <meta name="AUTHOR" content="Ramesh Ramachandran">
   <meta name="CREATED" content="20010122;16332400">
   <meta name="CHANGED" content="20010426;16141400">
<style>
	<!--
		H1 { color: #000000 }
		TD P { margin-left: 0.04in; margin-bottom: 0in; color: #000000 }
		H2 { color: #000000 }
		H3 { color: #000000 }
		H4 { color: #000000 }
		P { margin-left: 0.04in; margin-bottom: 0in; color: #000000 }
		BLOCKQUOTE { color: #000000 }
		DD { color: #000000 }
		A:link { color: #0000ee }
		A:visited { color: #551a8b }
	-->
	</style>
</head>
<body text="#000000" bgcolor="#FFFFFF" link="#0000EE" vlink="#551A8B">

<center>
<h1>
ECperf <sup><font size=+0>TM</font></sup> README</h1></center>

<center>
<h1>
<font size=-1>1.1 Final Release</font></h1></center>

<div STYLE="margin-bottom: 0.2in"><font size=-1>Copyright (c) 1998-2002
by Sun Microsystems, Inc. All Rights Reserved.</font></div>

<div STYLE="margin-bottom: 0.2in">This note describes the directory structure
of the ECperf kit and how to use it. The file you are currently viewing
is located as README.html in the top level ECperf directory. We will call&nbsp;
this top level directory as $ECPERF_HOME.</div>

<div STYLE="margin-bottom: 0.2in"><font size=-1><b>NOTE:&nbsp; </b>This
ECperf kit is distributed under the legal control and obligations of the
Java Community Process (JCP).&nbsp; Public release of information contained
in this draft of the ECperf specification, kit or results obtained by running
the kit are not permitted.</font>
<p><font size=-1>Please see the file <a href="redistributables.txt">'redistributables.txt'</a>
to find the list of ECperf files that can be redistributed.</font></div>

<div STYLE="margin-bottom: 0.2in"><i><font size=-1>Portions of the code
developed by <a href="http://www.apache.org">Apache Software Foundation</a></font></i></div>

<h2>
Contents</h2>

<ul>
<div STYLE="margin-bottom: 0.2in"><a href="#Assumptions">Assumptions</a>
<br><a href="#directory structure">Directory Structure</a>
<br><a href="#Package Structure">Java Package Structure</a>
<br><a href="#EJB Packages">EJB Package Structure</a>
<br><a href="#other packages">Other Packages</a>
<br><a href="#Configuring J2EE Server">Configuring J2EE Reference Implementation
Server</a>
<br><a href="#deploy">Building, Deploying and Running ECperf</a>
<br><a href="#testing">Testing the ECperf deployment</a>
<br><a href="#detail">Interpreting Detail Files</a>
<br><a href="#atomicity">Running Atomicity Tests</a></div>
</ul>

<h3>
<a NAME="Assumptions"></a>Assumptions</h3>

<div STYLE="margin-bottom: 0.2in">&nbsp;ECperf can be run on any Java platform.
Most of the code is implemented in Java, however there are a few scripts
used to start certain programs. These scripts are provided in .sh format
for Unix platforms and in .bat format for Windows.</div>

<h2>
<a NAME="directory structure"></a>Directory Structure</h2>

<ul>
<div STYLE="margin-bottom: 0.2in"><tt>ant : </tt>Ant installation directory
<br><tt>bin</tt> : Driver and database load scripts. All additional scripts
except specific database related scripts will be in this directory
<br><tt>classes</tt> : this is a directory for compiling Java classes and
packaging them. It comes with all the necessary class files necessary to
run ECperf.
<br><tt>classes/META-INF</tt> : temporary place for holding deployment
descriptors just before packaging into jar format files
<br><tt>classes/WEB-INF</tt> : temporary place for holding web deployment
descriptors just before packaging the war files
<br><tt>config</tt> : environment configuration and properties files used
by the Driver, make and&nbsp; load programs. Once ECperf has been successfully
deployed, this is the only place where&nbsp; the configuration should be
modified.
<br><tt>config/security</tt> : security policy files used for the benchmark
programs. These should not be modified
<br><tt>docs</tt> : javadoc documentation for all ECperf beans generated
by running <tt>make doc</tt>.
<br><tt>jars</tt> : jar files created by the make files. The files distributed
in this directory are <tt>driver.jar, launcher.jar, charts.jar , xerces.jar</tt><font face="times, serif">.
</font>The
application server specific jars for deployment need to be generated by
the user</div>

<div STYLE="margin-bottom: 0.2in"><tt>schema</tt> : schema information
and static data to be loaded into the database.
<br><tt>schema/sql</tt> : generic sql scripts for creating the tables,
etc. in the database. These should be copied and modified as necessary
for a particular database product.</div>

<p><br><b>Note:</b> For some of the popular DBMS products, DBMS specific
files are in <tt>schema/&lt;DBMS vendor></tt> and DBMS specific SQL scripts
are in <tt>schema/&lt;DBMS vendor>/sql.</tt>
<p><i><font face="Times New Roman, Times">If sent to us, we are willing
to re-distribute any DBMS specific scripts as part of the kit.</font></i>
<br>&nbsp;
<div STYLE="margin-bottom: 0.2in"><tt>src</tt> : root directory of the
source files. This contains generic and application server specific makefiles.
<br><tt>src/com</tt> : entry into the com.sun.ecperf package source
<br><tt>src/deploy</tt> : deployment descriptors
<br><tt>src/docroot</tt> : html and jsp pages used for the web interface.</div>
</ul>

<h2>
<a NAME="Package Structure"></a>Java Package Structure</h2>

<div STYLE="margin-bottom: 0.2in">All ECperf Java classes are located in
the <tt>com.sun.ecperf</tt> package. The following lists the sub packages
of <tt>com.sun.ecperf</tt>:</div>

<ul>
<div STYLE="margin-bottom: 0.2in"><tt>corp</tt>
<br><tt>orders</tt>
<br><tt>mfg</tt>
<br><tt>supplier</tt>
<br><tt>common</tt>
<br><tt>ruleengine</tt>
<br><tt>webbeans</tt>
<br><tt>driver</tt>
<br><tt>launcher</tt>
<br><tt>load</tt>
<br><tt>util</tt></div>
</ul>

<h3>
<a NAME="EJB Packages"></a>Packaging of Enterprise Java Beans</h3>

<div STYLE="margin-bottom: 0.2in">The beans adhere to EJB1.1 specification.
There are currently two versions for some of the beans - CMP and BMP. The
CMP version is to be used with Container Managed Persistence and the BMP
version must be used with Bean Managed Persistence. The BMP beans are sub
classed from CMP. The source file for the CMP and BMP are respectively
named <tt>&lt;bean>CmpEJB.java</tt> and
<tt>&lt;bean>BmpEJB.java</tt>.
The kit includes pre compiled class files for all the beans (both CMP and
BMP versions) and you can package them into appropriate ejb-jars for your
environment. For CMP, object to database (OR) mapping information is available
in the README.CMP file located in the src/deploy directory.</div>

<div STYLE="margin-bottom: 0.2in">Of the packages listed above, <tt>corp</tt>,
<tt>orders</tt>,
<tt>mfg</tt>,
and <tt>supplier</tt> contains the beans used for the four ECperf domains
respectively. Each domain package contains a distinct sub packages for
each EJB and its helper classes. The EJB package contains a sub package
named "ejb" which holds the bean implementation including the home and
remote interfaces. For instance, the following shows the fully qualified
class names for the <tt>OrderLineEnt</tt> entity bean:</div>

<ul>
<div STYLE="margin-bottom: 0.2in"><tt>com.sun.ecperf.orders.orderlineent.ejb.OrderLineEntHome</tt>
<br><tt>com.sun.ecperf.orders.orderlineent.ejb.OrderLineEnt</tt>
<br><tt>com.sun.ecperf.orders.orderlineent.ejb.OrderLineEntPK</tt>
<br><tt>com.sun.ecperf.orders.orderlineent.ejb.OrderLineCmpEJB</tt>
<br><tt>com.sun.ecperf.orders.orderlineent.ejb.OrderLineBmpEJB</tt></div>
</ul>

<div STYLE="margin-bottom: 0.2in">The helper classes for the orders domain
are in the <tt>helper</tt> sub package under <tt>orders</tt> as follows:</div>

<ul>
<div STYLE="margin-bottom: 0.2in"><tt>com.sun.ecperf.orders.helper.CustomerInfo</tt></div>

<div STYLE="margin-bottom: 0.2in"><tt>com.sun.ecperf.orders.helper.CustomerStatus</tt></div>

<div STYLE="margin-bottom: 0.2in"><tt>com.sun.ecperf.orders.helper.InsufficientCreditException</tt></div>

<div STYLE="margin-bottom: 0.2in"><tt>com.sun.ecperf.orders.helper.ItemQuantity</tt></div>

<p><br><tt>com.sun.ecperf.orders.helper.OrderStatus</tt></ul>

<h3>
<a NAME="other packages"></a>Other Java packages</h3>

<div STYLE="margin-bottom: 0.2in">Besides the 4 domains, several other
packages are included :</div>

<ul>
<blockquote STYLE="margin-bottom: 0in">The <tt>common</tt> package contains
the source code for helper classes used by all the beans (i.e. it is common
across different domains as well as beans)</blockquote>

<blockquote STYLE="margin-bottom: 0in">The <tt>ruleengine</tt> package
contains the rule parser used by the <tt>corp</tt> domain to evaluate order
discounts</blockquote>

<blockquote STYLE="margin-bottom: 0in">The <tt>util</tt> package contains
the beans used to generate primary keys</blockquote>

<blockquote STYLE="margin-bottom: 0in">The <tt>webbeans</tt> directory
contains Java Beans and support classes used by the web interface</blockquote>

<blockquote STYLE="margin-bottom: 0in">The <tt>supplier.emulator</tt> package
contains the Supplier Emulator Servlet.</blockquote>

<blockquote STYLE="margin-bottom: 0in">The <tt>charts</tt> package contains
a stand-alone Java application that can be used to chart transaction throughput
during an ECperf benchmark run (source not included)</blockquote>

<blockquote STYLE="margin-bottom: 0in">The <tt>driver</tt> package contains
the ECperf&nbsp; drivers (source not included)</blockquote>

<blockquote>The <tt>load</tt> package contains the database data generation
and load programs required to load the ECperf database(s) according to
the benchmark scaling rules.
<p><tt>xerces.jar</tt> is used by Delivery Servlet in Supplier domain and
the Supplier Emulator Servlet. Add this jar file in the Application server
classpath if XML DOM Parser packages are not part of your application server.
In the case of J2EE RI server this jar should be added in the J2EE_CLASSPATH
by editing J2EE_HOME/bin/userconfig.sh. To include this jar in the Tomcat
server, copy xerces.jar file to $TOMCAT_HOME/lib directory.</blockquote>
</ul>

<h2>
<span STYLE="font-weight: medium"><font face="times, serif"><font size=-1>NOTE:
To run charts application you need JClass Chart from <a href="http://www.klgroup.com/software/jclass/jclasschart.html">Sitraka
Software</a></font></font></span></h2>

<p><br><a NAME="Configuring J2EE Server"></a><b><font size=+1>Configuring
J2EE Reference Implementation Server</font></b>
<p><b>Configure JDBC driver,&nbsp; URL and Data Sources</b>
<br>&nbsp;&nbsp;&nbsp;&nbsp; For 1.3 version of the server use j2eeadmin
tool to add a new JDBC driver, URL and the Data source jdbc/ECperfDB. For
1.2.1 version manually edit default.properties file in the J2EE_HOME/config
directory.
<p><b>Adding additional jars in the CLASSPATH</b>
<br>&nbsp;&nbsp;&nbsp; For adding JDBC classes (Example : classes12.zip)
and xerces.jar into the classpath of the server, edit userconfig.sh file
in the J2EE_HOME/bin directory to include the jar files in J2EE_CLASSPATH.
<h2>
<a NAME="deploy"></a>Building, Deploying and Running ECperf</h2>

<div STYLE="margin-bottom: 0.2in">There are several components required
to deploy, test and run ECperf. These are :</div>

<ol>
<div STYLE="margin-bottom: 0.2in">An EJB Container to deploy all the ECperf
Beans.</div>

<div STYLE="margin-bottom: 0.2in">A Web Container to deploy the web client
as well as Delivery servlet in the Supplier Domain.</div>

<div STYLE="margin-bottom: 0.2in">An external Web Server to run the Supplier
Emulator Servlet. This web server should turn off <b>keep-alive</b> option.
Note that the emulator is not part of the SUT.</div>

<div STYLE="margin-bottom: 0.2in">The ECperf Driver that runs on external
client machine(s).</div>
</ol>

<div STYLE="margin-bottom: 0.2in">A diagram showing the various components
for a Standard Workload can be found&nbsp; <a href="deploy_std.jpg">here.</a></div>
A diagram showing the various components for a Distributed Workload can
be found&nbsp; <a href="deploy_dist.jpg">here.</a>
<div STYLE="margin-bottom: 0.2in">To build and deploy the benchmark the
kit uses
<i>ant</i> ( <a href="http://jakarta.apache.org/ant">http://jakarta.apache.org/ant</a>
).</div>
<a NAME="ant_build"></a><b>Build and Deployment process</b>
<br>&nbsp;
<div STYLE="margin-bottom: 0.2in">There are several steps that must be
followed in order to run the ECperf benchmark.</div>
<a href="#db_create">Create the database(s)</a>
<br><a href="#ant_ri_build">Build and Deployment process for the J2EE RI</a>
<br><a href="#ant_other_build">Build and Deployment process for another
appserver</a>
<br><a href="#ant_driver">Building the ECperf driver</a>
<br><a href="#db_load">Load the Database(s)</a>
<br><a href="#testing">Testing the ECperf deployment using the Web Interface</a>
<br><a href="#driver">Configuring and Running the Driver</a>
<br><a href="#DriverOutput">Analyzing Driver Results</a>
<h3>
<a NAME="db_create"></a>Create the Database(s)</h3>

<div STYLE="margin-bottom: 0.2in">For the Standard Workload, you can create
a single database that houses all the 4 Domains. For the Distributed Workload,
you must create 4 separate databases, one for each domain.
<p>Standard SQL scripts for creating the database schema are provided in
<tt>schema/sql</tt>.
These are intended to give a starting point for creating&nbsp; schemas
for other database products.
<p>For convenience database creation scripts are provided for Oracle 8
&amp; 9i, DB2 and Sybase in <tt>schema/&lt;DBMS>/createdb.sh</tt>. These
are example scripts and can be modified. However, see Clause 4.4 in the
specification for modification rules.
<br>&nbsp;</div>

<div STYLE="margin-bottom: 0.2in">See <tt>schema/sybase/setup_ecperf</tt>
for directions on how to create the databases for Sybase and
<tt>schema/DB2/README<font face="times, serif">
to create the databases for DB2.</font></tt></div>

<div STYLE="margin-bottom: 0.2in">Example : Creating the database and tables
for Oracle is as follows :
<blockquote>Read the comments in <tt>createdb.sh</tt> and edit the script
if necessary.
<br>Run the script as many times as the number of databases that you want
to create. Here is an example for the standard workload : <tt>createdb.sh
ecperf /export/home/oracle/dbs/ecperf_db</tt> where <tt>ecperf</tt> is
the name of the database and the 2nd argument is the name of the directory
that will contain the database files. Note that Oracle requires the database
name to be &lt;= 8 characters.
<br>The <tt>schema_?.sh </tt>(where ? is C, O, M or S) scripts create the
schema for the 4 domains. Edit the section marked <tt>######&nbsp; datafiles
######</tt> to set the path names of the Oracle devices appropriately.&nbsp;
The default values will work for a file system based database. Note that
the tablespace sizes may have to be increased when creating larger databases.&nbsp;
The scripts accept 2 arguments: database name and directory where database
files must be created.&nbsp; To create a single database named <tt>ecperf</tt>
for all 4 domains and locate it in the directory <tt>/export/home/oracle/dbs/ecperf_db,
</tt>use
the commands :
<br><tt>schema_C.sh ecperf /export/home/oracle/dbs/ecperf_db</tt>
<br><tt>schema_O.sh ecperf /export/home/oracle/dbs/ecperf_db</tt>
<br><tt>schema_M.sh ecperf /export/home/oracle/dbs/ecperf_db</tt>
<br><tt>schema_S.sh ecperf /export/home/oracle/dbs/ecperf_db</tt></blockquote>

<p><br><b>Run the schema_U.sh script in a similar manner to create the
sequence tables used to generate primary keys. This script must be run
once per database. i.e. if you are using only a single database for all
domains then once and if it is distributed you need to run this once for
each domain.</b>
<br>&nbsp;
<h3>
<a NAME="ant_ri_build"></a>Build and Deployment Process on the J2EE RI</h3>
Establish the correct environment. All environment settings like ECPERF_HOST,
ECPERF_PORT, etc. are taken from the config/ri.env file (not from the shell
environment) So make sure these are set in the .env file. Ensure you can
get to the ant binaries by including ant in your PATH</div>

<ol>
<ul>
<div STYLE="margin-bottom: 0.2in"><tt>PATH=$ECPERF_HOME/ant/bin:$PATH</tt></div>
</ul>
</ol>

<ol>
<ul>Edit the $ECPERF_HOME/config/ri.env properties file</ul>

<dd STYLE="margin-bottom: 0.2in">
These properties are reasonably straight forward and the file contains
further documentation.</dd>

<br>&nbsp;
<ul>
<div STYLE="margin-bottom: 0.2in">Build the .jar, .war and .ear files
<br><tt>$ cd $ECPERF_HOME</tt>
<br><tt>$ ant clean // makes sure the workspace is clean before starting
to build</tt>
<br><tt>$ ant // build the ECperf application components using the default
build.xml</tt>
<p>Build Load programs and initialize the database(s) with starting values
<br>Edit the $ECPERF_HOME/config/*db.properties files to establish the
correct JDBC connection properties for your database.
<br><tt>$ cd $ECPERF_HOME</tt>
<br><tt>$ ant loaddb</tt>
<br><tt><b>NOTE: </b>To load database for higher Injection Rate runs use
bin/loaddb.sh script</tt>
<p>Deploy the .ear files to a running J2EE RI server on $ECPERF_HOST
<br><tt>$ cd $ECPERF_HOME</tt>
<br><tt>$ ant -f ri.xml</tt>
<p>Deploy emulator to a running J2EE RI server on $EMULATOR_HOST
<br><tt>$ cd $ECPERF_HOME</tt>
<br><tt>$ ant -f ri.xml emulator-deploy</tt>
<p><b>OR</b>
<p>Build and deploy emulator on Tomcat server
<br>Edit the $ECPERF_HOME/config/tomcat.env properties file
<br><tt>$ cd $ECPERF_HOME</tt>
<br><tt>$ ant -f tomcat.xml</tt>
<br><tt>$ cp jars/Emulator.war $TOMCAT_HOME/webapps</tt>
<br><tt>$ rm -rf $TOMCAT_HOME/webapps/Emulator </tt>(if it is a redeployment)
<p>To generate optional charting classes
<br><tt>$ cd $ECPERF_HOME</tt>
<br><tt>$ ant -f ri.xml charts</tt>
<br><b><i><tt>NOTE: You need JClass Chart classes</tt></i></b></div>
</ul>
</ol>

<ul>
<dd STYLE="margin-bottom: 0.2in">
</dd>
</ul>

<h4>
<a NAME="ant_other_build"></a>Build and Deployment process&nbsp; on another
appserver</h4>

<div STYLE="margin-bottom: 0.2in">This example assumes the DB is created
and that the supplier emulator and the ECperf EJB's will be deployed to
the same running server on the same machine (this is the simplest of all
cases)</div>

<ol>
<div STYLE="margin-bottom: 0.2in">Choose a short name for your appserver.
For this example, let's call your appserver "mango"</div>

<div STYLE="margin-bottom: 0.2in">Copy the file config/ri.env to config/mango.env
and edit the properties particular to mango. It may very well be that you
won't need to make any changes to these settings at this time, but you
may need to add settings later to support deploy actions.</div>

<div STYLE="margin-bottom: 0.2in">Copy the directory src/deploy/reference
to src/deploy/mango with all its contents. Add vendor specific deployment
descriptors as necessary. There are two Stateful Session beans in the benchmark,
CartSes and BuyerSes. The idle time-out for CartSes should be set to run
duration as the driver reuses them randomly during the run and for BuyerSes
it should be set as short as possible.</div>

<div STYLE="margin-bottom: 0.2in">Try a build by doing "ant -Dappserver=mango"
This will do a full compile and try to build all the files needed for deployment.</div>

<div STYLE="margin-bottom: 0.2in">Edit the *db.env files in the config
directory so they have correct db driver info in preparation for doing
a db load.</div>
Try a database load by doing "ant -Dappserver=mango loaddb" Once those
are working, you should create a new file, mango.xml which has the deploy
rules. These will vary widely but you can use ri.xml as an example. You
should try to create the targets:
<p><tt>&nbsp;&nbsp;&nbsp;&nbsp; ecperf-war-deploy</tt>
<dd>
<tt>ecperf-ejb-deploy</tt></dd>

<dd>
<tt>supplier--deploy</tt></dd>

<dd>
<tt>emulator--deploy</tt></dd>
</ol>

<ol START=7>
<div STYLE="margin-bottom: 0.2in">When these are working, you should just
package up the mango.xml, config/mango.env, and src/deploy/mango/* files,
as well as any of the confg/*db.env files that may have native jdbc drivers
referenced in them, for convenience. Include instructions on how to deploy
ECperf for your appserver.</div>
</ol>

<h4>
Summary of steps required to run ECperf on a new appserver</h4>

<dl>
<dd>
1) Set up the appserver and database</dd>

<dd>
2) Add the ant bin dir to your path / classpath</dd>

<dd>
3) Adjust settings in config/mango.env for your local environment.</dd>

<dd>
4) On the main ECperf server from <tt>$ECPERF_HOME do </tt>"ant -find mango.xml
ecperf-ejb deploy"</dd>

<dd>
5) On the main web server, even if it's the same, from <tt>$ECPERF_HOME
</tt>do</dd>

<dd>
"ant -find mango.xml ecperf-war-deploy supplier-war-deploy"</dd>

<dd>
6) On the emulator server from <tt>$ECPERF_HOME </tt>do: "ant -find mango.xml
emulator-war-deploy"</dd>

<dd>
7) Load the database from <tt>$ECPERF_HOME </tt>by doing "ant -find mango.xml
loaddb"</dd>

<br>&nbsp;</dl>

<h4>
<a NAME="ant_driver"></a>Building the ECperf Driver</h4>

<div STYLE="margin-bottom: 0.2in">Source for the ECperf client driver is
now being packaged with the ECperf kit and targets are included in the
ant build.xml file to remove and re-build the driver.jar and launcher.jar
files, these commands are:-
<br><tt>&nbsp;&nbsp;&nbsp; $ ant clean-driver</tt>
<br><tt>&nbsp;&nbsp;&nbsp; $ ant driver</tt></div>

<ol>&nbsp;</ol>

<div STYLE="margin-bottom: 0.2in">The application including the web interface
and supplier emulator should now be deployed.</div>

<div STYLE="margin-bottom: 0.2in"><b>NOTES</b> :</div>

<ol>
<div STYLE="margin-bottom: 0.2in">Using the CMP version of <tt>SequenceEnt
</tt>requires
that <tt>UtilDataSource</tt> defined in <tt>util.xml</tt> have its isolation
level set to SERIALIZABLE. The CMP version will only work if your Container/DBMS
support the Serializable isolation level correctly. Consequently, we&nbsp;
suggest that you use the BMP version of <tt>SequenceEnt</tt>.</div>

<div STYLE="margin-bottom: 0.2in">The webclient and emulator are deployed
as .war files. If your appserver does not support these formats, then you
will have to make appropriate changes to<tt> &lt;appserver>.xml</tt> to
compile and deploy them.</div>
</ol>

<h3>
<a NAME="db_load"></a>Load the Database(s)</h3>

<ol>
<div STYLE="margin-bottom: 0.2in">Now that the database and tables are&nbsp;
created, and the load programs are compiled, follow these steps to load
the database:</div>
</ol>

<ol>
<div STYLE="margin-bottom: 0.2in">Edit the <tt>$ECPERF_HOME/config/appsserver</tt>
file and replace the current name with the name of the application server
being used.</div>

<div STYLE="margin-bottom: 0.2in">If the file <tt>$ECPERF_HOME</tt>/<tt>config/&lt;appsserver>.env</tt>
does not exist, copy it from <tt>$ECPERF_HOME/</tt>c<tt>onfig/ri.env</tt></div>

<div STYLE="margin-bottom: 0.2in">Edit <tt>$ECPERF_HOME/config/&lt;appsserver>.env
</tt>file
and ensure the <tt>JDBC_CLASSPATH</tt> variable points to a valid JDBC
driver and ECPERF_HOME points to root of ECperf distribution. Note that
the other variables are not used during the load.</div>

<div STYLE="margin-bottom: 0.2in">Uncomment jdbc URL and Driver class in
the <tt>$ECPERF_HOME/config/*db.properties</tt> files depending on what
database and driver you are using to access it. In the centralized configuration,
the contents of all files are the same.</div>

<div STYLE="margin-bottom: 0.2in">Run the <tt>bin/loaddb.sh</tt> script
from the <tt>$ECPERF_HOME</tt> directory to load all the databases. Read
the script to understand the order in which loads must be done. The LoadCorp
program writes out data to temporary files in /tmp. These files are then
read by the other load programs to populate their respective domains. If
any of the load programs fail, follow these steps :</div>

<div STYLE="margin-bottom: 0.2in">If LoadCorp failed, all of the domains
will have to be re-loaded. Re-run <tt>bin/loaddb.sh</tt>.</div>

<div STYLE="margin-bottom: 0.2in">If one of the other domain loads fail,
you can selectively re-load only this domain as long as the <tt>/tmp/*pipe</tt>
files created by LoadCorp have not been deleted.</div>

<div STYLE="margin-bottom: 0.2in">After successfully loading the database,
you should re-start Oracle with the <tt>$ORACLE_HOME/dbs/init&lt;db_name>.ora</tt>
startup file. This file is created by the <tt>createdb.sh</tt> script and
has a larger shared memory segment, processes etc. required for doing benchmark
runs.
<p><b>NOTE</b> : If you reload database you need to restart the appserver
as the SequenceSes bean caches primary key values to insert new rows in
the database.</div>
</ol>

<h3>
<a NAME="testing"></a>Testing the ECperf deployment using the Web interface</h3>

<div STYLE="margin-bottom: 0.2in">Assuming the application server is configured
properly and the beans have been successfully deployed, you should be able
to test the functionality of the ECperf application using the web interface.
If the deployment descriptor puts the web pages under the ECperf context
as defined by the deployment descriptors supplied for the J2EE RI, you
should be able to access the web page by pointing to the URL</div>

<p><br><tt>http://&lt;ECPERF_HOST>:&lt;ECPERF_PORT>/ECperf/</tt>

<p STYLE="margin-bottom: 0.2in">Test that all the functionality is in place
by trying the following transactions through the web interface :
<br>&nbsp;&nbsp;&nbsp; In Orders Domain :
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Create a new
order with one of the items having a quantity of more than 100 . This should
cause a large order to be created in the Manufacturing Domain
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Change the order
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get order information
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get information
on all orders of a customer
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cancel an order
<div STYLE="margin-bottom: 0.2in">&nbsp;&nbsp;&nbsp; In Manufacturing Domain
:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get a large
order and start processing a work order based on it
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Move the resulting
work order through its various stages.
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Create a new
work order
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cancel the work
order</div>

<div STYLE="margin-bottom: 0.2in">To make sure Delivery and Emulator servlets
are functioning :
<br>&nbsp;&nbsp; You should be able to verify by connecting to the following
URLs.
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; http://&lt;ECPERF_HOST>:&lt;ECPERF_PORT>&lt;ECPREF_PREFIX>Supplier/DeliveryServlet
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; http://&lt;EMULATOR_HOST>:&lt;EMULATOR_PORT>&lt;EMULATOR_PREFIX>Emulator/EmulatorServlet
<br>&nbsp;&nbsp; <i><tt>Note : In most cases the ECPERF and EMULATOR PREFIX
will be '/'</tt></i>
<p>If all of the above run successfully, you are ready to run the benchmark
using the Driver.</div>

<div STYLE="margin-bottom: 0.2in">&nbsp;
<br><a NAME="Driver Description"></a><b>Description of the Driver</b></div>

<div STYLE="margin-bottom: 0.2in">The ECperf Driver consists of several
Java programs and is designed to run on multiple client machines, using
an arbitrary number of JVMs to ensure that the Driver has no inherent scalability
limitations. Note that none of the client machines are part of the SUT.</div>

<p><br>We define the following terms :
<ul>
<div STYLE="margin-bottom: 0.2in">The <i>Master</i> machine: This is the
machine from which you drive the benchmark run. It is typically one of
the client systems.
<br>The <i>Agent</i> machines: These are the client machines on which the
various workloads run. The Master Machine can also be an Agent machine.</div>
</ul>

<div STYLE="margin-bottom: 0.2in">The Driver consists of the following
components :</div>

<ol>
<div STYLE="margin-bottom: 0.2in">The actual applications that implement
the workload as defined in the specifications. These are <i>OrderEntry</i>,
<i>PlannedLine</i>
and <i>LargeOrderLine</i>.
<br>The <i>Agents</i>, one per type of application. Each Agent manages
all the threads of its application. You can configure as many Agents as
you wish on any number of client machines. The Agents are <i>OrdersAgent</i>,
<i>MfgAgent</i>
and <i>LargeOLAgent</i>.
<br>The <i>Controller</i>, which runs on the Master machine and with which
all the Agents register.
<br>The <i>Driver</i>, which runs on the Master machine and which is responsible
for doing a benchmark run.</div>
</ol>

<h4>
How The Driver Works</h4>

<div STYLE="margin-bottom: 0.2in">The Driver communicates with all the
Agents using RMI. The Driver reads the run properties and configures the
Agents appropriately. Each Agent will then run as many threads of their
respective workload. For example, the OrdersAgent will run OrderEntry.
The number of threads is determined by the scaling rules of the specification
and are equally distributed amongst all Agents. Each thread runs independently,
executing the workload according to the rules defined in the spec. When
the run completes, the Driver co-ordinates with the Agents to retrieve
all the stats and prints out the reports.</div>

<h4>
<a NAME="InitialContext"></a>The Driver's InitialContext and Lookups</h4>

<div STYLE="margin-bottom: 0.2in">In the past, some people have had problems
with the way the Driver gets its InitialContext and lookups. This section
explains exactly how this is done.</div>

<p><br>The Driver obtains the JNDI InititalContext by executing the following
code in each of the client threads in Agent processes :
<ul>
<div STYLE="margin-bottom: 0.2in"><font face="Courier New, Courier">&nbsp;try
{</font>
<br><font face="Courier New, Courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context
= new InitialContext();</font>
<br><font face="Courier New, Courier">} catch (NamingException ne) {</font>
<br><font face="Courier New, Courier">&nbsp;&nbsp;&nbsp;&nbsp; throw new
RemoteException("InitialContext failed. " + ne);</font></div>
<font face="Courier New, Courier">}</font></ul>

<p><br>Each of the bean home interfaces that the applications require is
looked up using the absolute home name of the bean. An example is shown
below :
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font face="Courier New, Courier">
OrderSesHome orderSesHome =</font>
<br><font face="Courier New, Courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(OrderSesHome) PortableRemoteObject.narrow</font>
<br><font face="Courier New, Courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(ctx.lookup("OrderSesHome"), OrderSesHome.class);</font>

<p STYLE="margin-bottom: 0.2in">If your app server needs extra properties
to be set for the InitialContext, this can be done by setting them in <tt>jndi.properties</tt>
in the CLASSPATH or changing the variable JAVA in config/&lt;appserver>.env.
The example&nbsp; given below shows a generic implementation (see below
for AppServer specific Values) :

<p STYLE="margin-bottom: 0.2in">&nbsp;&nbsp;&nbsp;&nbsp; JAVA="$JAVA_HOME/bin/java

<p STYLE="margin-bottom: 0.2in">&nbsp;&nbsp;&nbsp;&nbsp; -Djava.naming.factory.initial=vendor
naming factory goes here
<div STYLE="margin-bottom: 0.2in">&nbsp;&nbsp;&nbsp;&nbsp; -Djava.naming.provider.url=vendor
url goes here</div>

<div STYLE="margin-bottom: 0.2in"><b><tt>iPlanet</tt></b></div>

<div STYLE="margin-bottom: 0.2in"><tt>-Djava.naming.factory.initial=com.sun.jndi.cosnaming.CNCtxFactory</tt></div>

<div STYLE="margin-bottom: 0.2in"><tt>-Djava.naming.provider.url=iiop://${ECPERF_HOST}:${IIOP_PORT}</tt></div>

<div STYLE="margin-bottom: 0.2in"><b><tt>Web Logic</tt></b></div>

<div STYLE="margin-bottom: 0.2in"><font face="Courier New, Courier">-Djava.naming.factory.initial=weblogic.jndi.WLInitialContextFactory</font></div>

<div STYLE="margin-bottom: 0.2in"><font face="Courier New, Courier">-Djava.naming.provider.url=t3://${ECPERF_HOST}:${ECPERF_PORT}</font></div>

<div STYLE="margin-bottom: 0.2in"><b><font face="Courier New, Courier">WebSphere</font></b></div>

<div STYLE="margin-bottom: 0.2in"><font face="Courier New, Courier">-Djava.naming.factory.initial=com.ibm.websphere.naming.WsnInitialContextFactory</font></div>

<div STYLE="margin-bottom: 0.2in"><font face="Courier New, Courier">-Djava.naming.provider.url=iiop://${ECPERF_HOST}:${ECPERF_PORT}"</font></div>

<h3>
<a NAME="driver"></a>Configuring and Running the Driver</h3>

<div STYLE="margin-bottom: 0.2in">Read&nbsp; <a href="#Driver Description">the
description of the Driver</a>&nbsp; first to understand how it works. Follow
these steps to configure the Driver for any particular application server:</div>

<ol>
<div STYLE="margin-bottom: 0.2in">Edit <tt>$ECPERF_HOME/config/appsserver</tt>
to contain the name of the application server&nbsp; you want to run.</div>

<div STYLE="margin-bottom: 0.2in">Edit <tt>$ECPERF_HOME/config/&lt;appsserver>.env</tt>
to contain the correct values for the following variables :</div>
</ol>

<ul>
<div STYLE="margin-bottom: 0.2in"><tt>JAVA_HOME</tt> - Path name of your
JDK installation</div>

<div STYLE="margin-bottom: 0.2in">&lt;APPSERVER>_HOME - Path to your app
server installation</div>

<div STYLE="margin-bottom: 0.2in">ECPERF_HOME&nbsp; - Path to the root
directory of ECperf distribution</div>

<div STYLE="margin-bottom: 0.2in"><tt>CLASSPATH</tt> - Path to all the
library and client jar files needed to run an EJB client for your particular
application server</div>

<div STYLE="margin-bottom: 0.2in"><tt>BINDWAIT</tt> - Time to wait for
the RMI server to bind when starting the Driver; defaults to 5 seconds</div>

<div STYLE="margin-bottom: 0.2in"><tt>JAVA</tt> - The Java executable to
run. Some application servers require the client to call a wrapper instead
of the <tt>java</tt> command. If this is not set, it defaults to <tt>$JAVA_HOME/bin/java</tt></div>
</ul>

<ol START=3>
<div STYLE="margin-bottom: 0.2in">Edit <tt>$ECPERF_HOME/config/run.properties</tt>
and set the ECperf run parameters appropriately. The parameters are described
in comments in this file. Ensure that <tt>dumpStats</tt> is 0 if you are
not running the charting application, as otherwise the Driver will hang
waiting for the reader on the pipe. If you cannot meet the mix requirements
for the OrderEntry application, these can be adjusted by changing various
Weight parameters (custsWeight, ordsWeight, chgoWeight and newoWeight).
All the parameters can be multiplied by a factor of 10 or 100 for better
granularity.
<p>Edit <tt>$ECPERF_HOME/config/agent.properties.</tt> There are currently
no values you can change in this file.
<p>Check that the method used by the Driver to get its&nbsp; <a href="#InitialContext">InitialContext
and do lookups</a> will work for your appserver.
<p>Now, run the driver by running the script
<tt>bin/driver.sh [&lt;driver
host>] </tt>from the $ECPERF_HOME directory.
<p>You can abort a run at any time by pressing <tt>Ctrl-C</tt>. This will
cause all the processes to exit gracefully.
<p>If there were errors during pervious run, M_largeorder table may have
entries which will affect the BBops of the run. So make sure before each
run the M_largeorder table is empty by reloading the database or by deleting
entries from M_largeorder table using SQL command.</div>

<div STYLE="margin-bottom: 0.2in">&nbsp;</div>
</ol>

<div STYLE="margin-bottom: 0.2in"><b>Notes</b>:</div>

<div STYLE="margin-bottom: 0.2in"><font face="times, serif"><font size=+0>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
If no </font></font><tt>&lt;driver host> </tt><font face="times, serif"><font size=+0>is
specified by default local host is used.</font></font></div>

<div STYLE="margin-bottom: 0.2in"><font face="times, serif"><font size=+0>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
We have sometimes experienced binding exceptions at the start of the first
time run. For now, just cancel the script (by pressing <tt>Ctrl-C</tt>)
and rerun it again. This problem usually does not persist to the second
run.</font></font></div>

<ol><font size=+0><font face="times, serif">The<i> </i></font><i><tt><font face="courier, monospace">driver.sh
</font></tt></i><font face="times, serif">script
starts all Agents on the Master machine. If you want to start the Agents
on different client systems, the script needs to be edited appropriately.</font></font></ol>

<ol>
<div STYLE="margin-bottom: 0.2in"><font face="times, serif"><font size=+0>We
have also provided a driver.bat file and the instructions to run it is
provided in </font></font><a href="NTDriver.html">NTDriver.html</a></div>
</ol>

<h4>
<a NAME="DriverOutput"></a>Driver Run Output</h4>

<div STYLE="margin-bottom: 0.2in">After a successful run, you should see
a directory <i>run_number</i> created in the directory specified by the
outDir property in <tt>config/run.properties</tt>. The run number will
start at 1 and be incremented for each run. The current run's number is
stored in the file <tt>ecperf.seq</tt> in the user's home directory. For
example, if outDir = /export/home/ecperf/output, the first run's output
will go into the directory /export/home/ecperf/output/1. In the run output
directory, you will find the following files :</div>

<br>&nbsp;
<center>
<p><b>Run output files and their description</b></center>

<p><br>
<table BORDER CELLSPACING=3 CELLPADDING=2 WIDTH="100%" >
<tr>
<td WIDTH="11%"><font size=-1>ECperf.summary</font></td>

<td WIDTH="89%"><font size=-1>A summary file giving the final ECperf metrics</font></td>
</tr>

<tr>
<td><font size=-1>Audit.report</font></td>

<td><font size=-1>A summary file giving the Audit report</font></td>
</tr>

<tr>
<td WIDTH="11%"><font size=-1>Orders.summary</font></td>

<td WIDTH="89%"><font size=-1>A summary file giving the results of the
OrderEntry application</font></td>
</tr>

<tr>
<td WIDTH="11%"><font size=-1>Orders.detail</font></td>

<td WIDTH="89%"><font size=-1>A detail file giving histogram data that
can be used to produce graphs</font></td>
</tr>

<tr>
<td WIDTH="11%"><font size=-1>ords.err</font></td>

<td WIDTH="89%"><font size=-1>A log of any errors encountered during the
run.&nbsp;</font></td>
</tr>

<tr>
<td WIDTH="11%"><font size=-1>Mfg.summary</font></td>

<td WIDTH="89%"><font size=-1>A summary file giving the results of the
Mfg applications</font></td>
</tr>

<tr>
<td WIDTH="11%"><font size=-1>Mfg.detail&nbsp;</font></td>

<td WIDTH="89%"><font size=-1>A detail file giving histogram data of the
Mfg applications</font></td>
</tr>

<tr>
<td WIDTH="11%"><font size=-1>plannedlines.err</font></td>

<td WIDTH="89%"><font size=-1>A log of errors encountered by the PlannedLine
application</font></td>
</tr>

<tr>
<td WIDTH="11%"><font size=-1>loline.err</font></td>

<td WIDTH="89%"><font size=-1>A log of errors encountered by the LargeOrderLine
application</font></td>
</tr>

<tr>
<td WIDTH="11%"><font size=-1>delivery.err</font></td>

<td WIDTH="89%"><font size=-1>A log of errors by Supplier Domain servlet</font></td>
</tr>

<tr>
<td WIDTH="11%"><font size=-1>emulator.err</font></td>

<td WIDTH="89%"><font size=-1>A log of errors by Emulator servlet</font></td>
</tr>
</table>


<p STYLE="margin-bottom: 0.2in">NOTE: All errors encountered by the Agents/Applications
will be logged in the respective .err file. Only errors encountered by
the Driver will appear on the screen in which the Driver was started. As
such, you should always check the error logs in the run output directory.
<br>&nbsp;
<h4>
<a NAME="detail"></a>Interpreting Detail files</h4>

<div STYLE="margin-bottom: 0.2in">The Driver produces two detail files,
Orders.detail and Mfg.detail in the run output directory. Each of these
files have throughput and response time data that are required to produce
the graphs mentioned in Clause 4.10 of the specification.</div>

<p><br>Here is an example of the first few lines from an Orders.detail
file :

<p STYLE="margin-bottom: 0.2in"><font face="Times New Roman, Times"><font size=-1>Neworder
Throughput</font></font>
<br><font face="Times New Roman, Times"><font size=-1>TIME COUNT OF TX.</font></font>
<br><font face="Times New Roman, Times"><font size=-1>0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
85</font></font>
<br><font face="Times New Roman, Times"><font size=-1>30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
78</font></font>
<br><font face="Times New Roman, Times"><font size=-1>60&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
68</font></font>
<br><font face="Times New Roman, Times"><font size=-1>90&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
79</font></font>

<p STYLE="margin-bottom: 0.2in">This means that 85 neworder transactions
were completed in the first 30 seconds of the benchmark run, 78 in the
next 30 seconds, 68 in the 3rd 30 second interval and so on.
<br>Now, let us look at an example of response time data :

<p STYLE="margin-bottom: 0.2in"><font face="Times New Roman, Times"><font size=-1>NEWORDER</font></font>
<br><font face="Times New Roman, Times"><font size=-1>0.000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
147</font></font>
<br><font face="Times New Roman, Times"><font size=-1>0.100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
140</font></font>
<br><font face="Times New Roman, Times"><font size=-1>0.200&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
8</font></font>
<br><font face="Times New Roman, Times"><font size=-1>0.300&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
0</font></font>
<p>This shows that 147 transactions completed within 0.1 seconds, 140 had
a response time in between 0.1 and 0.2 seconds and only 8 transactions
had a response time greater than 0.2 seconds. Note that response time data
are gathered only during steady-state where as throughput data are collected
for the entire duration of the run.
<br>&nbsp;
<h4>
<a NAME="atomicity"></a>Running Atomicity Tests</h4>

<div STYLE="margin-bottom: 0.2in">Clause 4.11.1 of the specification details
the requirements for atomicity of the transactions. The code to run the
various atomicity tests is implemented via the Debug class in the OrderEnt
and LargeOrderEnt beans. Debug level 4 is used for the atomicity tests.
To run Atomicity Tests 1 and 2, change the environment variable <tt>debuglevel
</tt>of
OrderEnt to 4 in orders.xml. Similarly, to run Atomicity Test 3, change
<tt>debuglevel</tt>
of LargeOrderEnt to 4 in mfg.xml.</div>

</body>
</html>
