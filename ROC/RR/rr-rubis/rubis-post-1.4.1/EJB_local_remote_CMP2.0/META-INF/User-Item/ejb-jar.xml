<?xml version="1.0"?>
<!DOCTYPE ejb-jar PUBLIC "-//Sun Microsystems, Inc.//DTD Enterprise JavaBeans 2.0//EN" "http://java.sun.com/dtd/ejb-jar_2_0.dtd">

<!-- Category, Region, User, Item, Bid Entity Beans -->

<ejb-jar>
  <enterprise-beans>
    <entity>
      <description>Category Bean deployment descriptor</description>
      <display-name>Category</display-name>
      <ejb-name>Category</ejb-name>
      <local-home>edu.rice.rubis.beans.CategoryLocalHome</local-home>
      <local>edu.rice.rubis.beans.CategoryLocal</local>
      <ejb-class>edu.rice.rubis.beans.CategoryBean</ejb-class>
      <persistence-type>Container</persistence-type>
      <prim-key-class>edu.rice.rubis.beans.CategoryPK</prim-key-class>
      <reentrant>False</reentrant>
      <cmp-version>2.x</cmp-version>
      <abstract-schema-name>CategoryBean</abstract-schema-name>
      <ejb-local-ref>
        <description>This is the reference to the id manager</description>
        <ejb-ref-name>ejb/IDManager</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <ejb-link>IDManager</ejb-link>
        <local-home>edu.rice.rubis.beans.IDManagerLocalHome</local-home>
        <local>edu.rice.rubis.beans.IDManagerLocal</local>
      </ejb-local-ref>
      <cmp-field>
        <field-name>name</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>id</field-name>
      </cmp-field>
      <query>
        <query-method>
          <method-name>findByName</method-name>
          <method-params>
            <method-param>java.lang.String</method-param>
          </method-params>
        </query-method>
        <ejb-ql>
<![CDATA[
                    SELECT DISTINCT OBJECT(c)
                    FROM CategoryBean c
                    WHERE c.name = ?1
               ]]>
        </ejb-ql>
      </query>
      <query>
        <query-method>
          <method-name>findAllCategories</method-name>
          <method-params/>
        </query-method>
        <ejb-ql>
<![CDATA[
                    SELECT OBJECT(c)
                    FROM CategoryBean c
               ]]>
        </ejb-ql>
      </query>
      <query>
        <query-method>
          <method-name>ejbSelectCurrentItemsInCategory</method-name>
          <method-params>
            <method-param>java.lang.Integer</method-param>
            <method-param>int</method-param>
            <method-param>int</method-param>
          </method-params>
        </query-method>
        <result-type-mapping>Local</result-type-mapping>
        <ejb-ql/>
      </query>
      <query>
        <query-method>
          <method-name>ejbSelectCurrentItemsInCategoryAndRegion</method-name>
          <method-params>
            <method-param>java.lang.Integer</method-param>
            <method-param>java.lang.Integer</method-param>
            <method-param>int</method-param>
            <method-param>int</method-param>
          </method-params>
        </query-method>
        <result-type-mapping>Local</result-type-mapping>
        <ejb-ql/>
      </query>
      <resource-ref>
        <res-ref-name>jdbc/rubis</res-ref-name>
        <res-type>javax.sql.DataSource</res-type>
        <res-auth>Container</res-auth>
      </resource-ref>
    </entity>
    <entity>
      <description>Region Bean deployment descriptor</description>
      <display-name>Region</display-name>
      <ejb-name>Region</ejb-name>
      <local-home>edu.rice.rubis.beans.RegionLocalHome</local-home>
      <local>edu.rice.rubis.beans.RegionLocal</local>
      <ejb-class>edu.rice.rubis.beans.RegionBean</ejb-class>
      <persistence-type>Container</persistence-type>
      <prim-key-class>edu.rice.rubis.beans.RegionPK</prim-key-class>
      <reentrant>False</reentrant>
      <cmp-version>2.x</cmp-version>
      <abstract-schema-name>RegionBean</abstract-schema-name>
      <ejb-local-ref>
        <description>This is the reference to the id manager</description>
        <ejb-ref-name>ejb/IDManager</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <ejb-link>IDManager</ejb-link>
        <local-home>edu.rice.rubis.beans.IDManagerLocalHome</local-home>
        <local>edu.rice.rubis.beans.IDManagerLocal</local>
      </ejb-local-ref>
      <cmp-field>
        <field-name>id</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>name</field-name>
      </cmp-field>
      <query>
        <query-method>
          <method-name>findByName</method-name>
          <method-params>
            <method-param>java.lang.String</method-param>
          </method-params>
        </query-method>
        <ejb-ql>
<![CDATA[
                    SELECT DISTINCT OBJECT(r)
                    FROM RegionBean r
                    WHERE r.name = ?1
               ]]>
        </ejb-ql>
      </query>
      <query>
        <query-method>
          <method-name>findAllRegions</method-name>
          <method-params/>
        </query-method>
        <ejb-ql>
<![CDATA[
                    SELECT OBJECT(r)
                    FROM RegionBean r
               ]]>
        </ejb-ql>
      </query>
      <resource-ref>
        <res-ref-name>jdbc/rubis</res-ref-name>
        <res-type>javax.sql.DataSource</res-type>
        <res-auth>Container</res-auth>
      </resource-ref>
    </entity>
    <entity>
      <description>User Bean deployment descriptor</description>
      <display-name>User</display-name>
      <ejb-name>User</ejb-name>
      <local-home>edu.rice.rubis.beans.UserLocalHome</local-home>
      <local>edu.rice.rubis.beans.UserLocal</local>
      <ejb-class>edu.rice.rubis.beans.UserBean</ejb-class>
      <persistence-type>Container</persistence-type>
      <prim-key-class>edu.rice.rubis.beans.UserPK</prim-key-class>
      <reentrant>False</reentrant>
      <cmp-version>2.x</cmp-version>
      <abstract-schema-name>UserBean</abstract-schema-name>
      <ejb-local-ref>
        <description>This is the reference to the id manager</description>
        <ejb-ref-name>ejb/IDManager</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <ejb-link>IDManager</ejb-link>
        <local-home>edu.rice.rubis.beans.IDManagerLocalHome</local-home>
        <local>edu.rice.rubis.beans.IDManagerLocal</local>
      </ejb-local-ref>
      <cmp-field>
        <field-name>id</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>firstName</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>lastName</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>nickName</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>password</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>email</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>rating</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>balance</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>creationDate</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>regionId</field-name>
      </cmp-field>
      <query>
        <query-method>
          <method-name>findByNickName</method-name>
          <method-params>
            <method-param>java.lang.String</method-param>
          </method-params>
        </query-method>
        <ejb-ql>
<![CDATA[
                    SELECT DISTINCT OBJECT(u)
                    FROM UserBean u
                    WHERE u.nickName = ?1
               ]]>
        </ejb-ql>
      </query>
      <query>
        <query-method>
          <method-name>findAllUsers</method-name>
          <method-params/>
        </query-method>
        <ejb-ql>
<![CDATA[
                    SELECT OBJECT(u)
                    FROM UserBean u
               ]]>
        </ejb-ql>
      </query>
      <query>
        <query-method>
          <method-name>ejbSelectUserWonItems</method-name>
          <method-params>
            <method-param>java.lang.Integer</method-param>
          </method-params>
        </query-method>
        <result-type-mapping>Local</result-type-mapping>
        <ejb-ql/>
      </query>
      <query>
        <query-method>
          <method-name>ejbSelectUserBids</method-name>
          <method-params>
            <method-param>java.lang.Integer</method-param>
          </method-params>
        </query-method>
        <result-type-mapping>Local</result-type-mapping>
        <ejb-ql/>
      </query>
      <resource-ref>
        <res-ref-name>jdbc/rubis</res-ref-name>
        <res-type>javax.sql.DataSource</res-type>
        <res-auth>Container</res-auth>
      </resource-ref>
    </entity>
    <entity>
      <description>Item Bean deployment descriptor</description>
      <display-name>Item</display-name>
      <ejb-name>Item</ejb-name>
      <local-home>edu.rice.rubis.beans.ItemLocalHome</local-home>
      <local>edu.rice.rubis.beans.ItemLocal</local>
      <ejb-class>edu.rice.rubis.beans.ItemBean</ejb-class>
      <persistence-type>Container</persistence-type>
      <prim-key-class>edu.rice.rubis.beans.ItemPK</prim-key-class>
      <reentrant>False</reentrant>
      <cmp-version>2.x</cmp-version>
      <abstract-schema-name>ItemBean</abstract-schema-name>
      <ejb-local-ref>
        <description>This is the reference to the id manager</description>
        <ejb-ref-name>ejb/IDManager</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <ejb-link>IDManager</ejb-link>
        <local-home>edu.rice.rubis.beans.IDManagerLocalHome</local-home>
        <local>edu.rice.rubis.beans.IDManagerLocal</local>
      </ejb-local-ref>
      <ejb-local-ref>
        <description>This is the reference to the user  bean</description>
        <ejb-ref-name>ejb/User</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <ejb-link>User</ejb-link>
        <local-home>edu.rice.rubis.beans.UserLocalHome</local-home>
        <local>edu.rice.rubis.beans.UserLocal</local>
      </ejb-local-ref>
      <ejb-local-ref>
        <description>This is the reference to the category  bean</description>
        <ejb-ref-name>ejb/Category</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <ejb-link>Category</ejb-link>
        <local-home>edu.rice.rubis.beans.CategoryLocalHome</local-home>
        <local>edu.rice.rubis.beans.CategoryLocal</local>
      </ejb-local-ref>
      <cmp-field>
        <field-name>id</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>name</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>description</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>initialPrice</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>quantity</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>reservePrice</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>buyNow</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>nbOfBids</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>maxBid</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>startDate</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>endDate</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>sellerId</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>categoryId</field-name>
      </cmp-field>
      <query>
        <query-method>
          <method-name>findBySeller</method-name>
          <method-params>
            <method-param>java.lang.Integer</method-param>
          </method-params>
        </query-method>
        <ejb-ql>
<![CDATA[
                    SELECT OBJECT(i)
                    FROM ItemBean i
                    WHERE i.sellerId = ?1
               ]]>
        </ejb-ql>
      </query>
      <query>
        <query-method>
          <method-name>findByCategory</method-name>
          <method-params>
            <method-param>java.lang.Integer</method-param>
          </method-params>
        </query-method>
        <ejb-ql>
<![CDATA[
                    SELECT OBJECT(i)
                    FROM ItemBean i
                    WHERE i.categoryId = ?1
               ]]>
        </ejb-ql>
      </query>
      <query>
        <query-method>
          <method-name>findCurrentByCategory</method-name>
          <method-params>
            <method-param>java.lang.Integer</method-param>
          </method-params>
        </query-method>
        <ejb-ql/>
      </query>
      <query>
        <query-method>
          <method-name>findUserCurrentSellings</method-name>
          <method-params>
            <method-param>java.lang.Integer</method-param>
          </method-params>
        </query-method>
        <ejb-ql/>
      </query>
      <query>
        <query-method>
          <method-name>findUserPastSellings</method-name>
          <method-params>
            <method-param>java.lang.Integer</method-param>
          </method-params>
        </query-method>
        <ejb-ql/>
      </query>
      <query>
        <query-method>
          <method-name>findAllItems</method-name>
          <method-params/>
        </query-method>
        <ejb-ql>
<![CDATA[
                    SELECT OBJECT(i)
                    FROM ItemBean i
               ]]>
        </ejb-ql>
      </query>
      <query>
        <query-method>
          <method-name>ejbSelectItemQtyMaxBid</method-name>
          <method-params>
            <method-param>int</method-param>
            <method-param>java.lang.Integer</method-param>
          </method-params>
        </query-method>
        <result-type-mapping>Local</result-type-mapping>
        <ejb-ql/>
      </query>
      <query>
        <query-method>
          <method-name>ejbSelectItemBidHistory</method-name>
          <method-params>
            <method-param>java.lang.Integer</method-param>
          </method-params>
        </query-method>
        <result-type-mapping>Local</result-type-mapping>
        <ejb-ql/>
      </query>
      <resource-ref>
        <res-ref-name>jdbc/rubis</res-ref-name>
        <res-type>javax.sql.DataSource</res-type>
        <res-auth>Container</res-auth>
      </resource-ref>
    </entity>
    <entity>
      <description>Bid Bean deployment descriptor</description>
      <display-name>Bid</display-name>
      <ejb-name>Bid</ejb-name>
      <local-home>edu.rice.rubis.beans.BidLocalHome</local-home>
      <local>edu.rice.rubis.beans.BidLocal</local>
      <ejb-class>edu.rice.rubis.beans.BidBean</ejb-class>
      <persistence-type>Container</persistence-type>
      <prim-key-class>edu.rice.rubis.beans.BidPK</prim-key-class>
      <reentrant>False</reentrant>
      <cmp-version>2.x</cmp-version>
      <abstract-schema-name>BidBean</abstract-schema-name>
      <ejb-local-ref>
        <description>This is the reference to the id manager</description>
        <ejb-ref-name>ejb/IDManager</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <ejb-link>IDManager</ejb-link>
        <local-home>edu.rice.rubis.beans.IDManagerLocalHome</local-home>
        <local>edu.rice.rubis.beans.IDManagerLocal</local>
      </ejb-local-ref>
      <ejb-local-ref>
        <description>This is the reference to the user</description>
        <ejb-ref-name>ejb/User</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <ejb-link>User</ejb-link>
        <local-home>edu.rice.rubis.beans.UserLocalHome</local-home>
        <local>edu.rice.rubis.beans.UserLocal</local>
      </ejb-local-ref>
      <ejb-local-ref>
        <description>This is the reference to the item</description>
        <ejb-ref-name>ejb/Item</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <ejb-link>Item</ejb-link>
        <local-home>edu.rice.rubis.beans.ItemLocalHome</local-home>
        <local>edu.rice.rubis.beans.ItemLocal</local>
      </ejb-local-ref>
      <cmp-field>
        <field-name>id</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>userId</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>itemId</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>quantity</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>bid</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>maxBid</field-name>
      </cmp-field>
      <cmp-field>
        <field-name>date</field-name>
      </cmp-field>
      <query>
        <query-method>
          <method-name>findByItem</method-name>
          <method-params>
            <method-param>java.lang.Integer</method-param>
          </method-params>
        </query-method>
        <ejb-ql>
<![CDATA[
                    SELECT OBJECT(b)
                    FROM BidBean b
                    WHERE b.itemId = ?1
               ]]>
        </ejb-ql>
      </query>
      <query>
        <query-method>
          <method-name>findByUser</method-name>
          <method-params>
            <method-param>java.lang.Integer</method-param>
          </method-params>
        </query-method>
        <ejb-ql>
<![CDATA[
                    SELECT OBJECT(b)
                    FROM BidBean b
                    WHERE b.userId = ?1
               ]]>
        </ejb-ql>
      </query>
      <query>
        <query-method>
          <method-name>findAllBids</method-name>
          <method-params/>
        </query-method>
        <ejb-ql>
<![CDATA[
                    SELECT OBJECT(b)
                    FROM BidBean b
               ]]>
        </ejb-ql>
      </query>
      <resource-ref>
        <res-ref-name>jdbc/rubis</res-ref-name>
        <res-type>javax.sql.DataSource</res-type>
        <res-auth>Container</res-auth>
      </resource-ref>
    </entity>
  </enterprise-beans>
  <relationships>
    <ejb-relation>
      <ejb-relation-name>Category-Item</ejb-relation-name>
      <ejb-relationship-role>
        <ejb-relationship-role-name>one-category-has-many-items</ejb-relationship-role-name>
        <multiplicity>One</multiplicity>
        <relationship-role-source>
          <ejb-name>Category</ejb-name>
        </relationship-role-source>
        <cmr-field>
          <cmr-field-name>items</cmr-field-name>
          <cmr-field-type>java.util.Collection</cmr-field-type>
        </cmr-field>
      </ejb-relationship-role>
      <ejb-relationship-role>
        <ejb-relationship-role-name>many-items-belong-to-one-category</ejb-relationship-role-name>
        <multiplicity>Many</multiplicity>
        <relationship-role-source>
          <ejb-name>Item</ejb-name>
        </relationship-role-source>
      </ejb-relationship-role>
    </ejb-relation>
    <ejb-relation>
      <ejb-relation-name>Region-User</ejb-relation-name>
      <ejb-relationship-role>
        <ejb-relationship-role-name>one-region-has-many-users</ejb-relationship-role-name>
        <multiplicity>One</multiplicity>
        <relationship-role-source>
          <ejb-name>Region</ejb-name>
        </relationship-role-source>
        <cmr-field>
          <cmr-field-name>users</cmr-field-name>
          <cmr-field-type>java.util.Collection</cmr-field-type>
        </cmr-field>
      </ejb-relationship-role>
      <ejb-relationship-role>
        <ejb-relationship-role-name>many-users-belong-to-one-region</ejb-relationship-role-name>
        <multiplicity>Many</multiplicity>
        <relationship-role-source>
          <ejb-name>User</ejb-name>
        </relationship-role-source>
      </ejb-relationship-role>
    </ejb-relation>
    <ejb-relation>
      <ejb-relation-name>User-Item</ejb-relation-name>
      <ejb-relationship-role>
        <ejb-relationship-role-name>one-user-sells-many-items</ejb-relationship-role-name>
        <multiplicity>One</multiplicity>
        <relationship-role-source>
          <ejb-name>User</ejb-name>
        </relationship-role-source>
        <cmr-field>
          <cmr-field-name>items</cmr-field-name>
          <cmr-field-type>java.util.Collection</cmr-field-type>
        </cmr-field>
      </ejb-relationship-role>
      <ejb-relationship-role>
        <ejb-relationship-role-name>many-items-belong-to-one-user</ejb-relationship-role-name>
        <multiplicity>Many</multiplicity>
        <relationship-role-source>
          <ejb-name>Item</ejb-name>
        </relationship-role-source>
      </ejb-relationship-role>
    </ejb-relation>
    <ejb-relation>
      <ejb-relation-name>User-Bid</ejb-relation-name>
      <ejb-relationship-role>
        <ejb-relationship-role-name>one-user-puts-many-bids</ejb-relationship-role-name>
        <multiplicity>One</multiplicity>
        <relationship-role-source>
          <ejb-name>User</ejb-name>
        </relationship-role-source>
        <cmr-field>
          <cmr-field-name>bids</cmr-field-name>
          <cmr-field-type>java.util.Collection</cmr-field-type>
        </cmr-field>
      </ejb-relationship-role>
      <ejb-relationship-role>
        <ejb-relationship-role-name>many-bids-belong-to-one-user</ejb-relationship-role-name>
        <multiplicity>Many</multiplicity>
        <relationship-role-source>
          <ejb-name>Bid</ejb-name>
        </relationship-role-source>
      </ejb-relationship-role>
    </ejb-relation>
    <ejb-relation>
      <ejb-relation-name>Item-Bid</ejb-relation-name>
      <ejb-relationship-role>
        <ejb-relationship-role-name>one-item-has-many-bids</ejb-relationship-role-name>
        <multiplicity>One</multiplicity>
        <relationship-role-source>
          <ejb-name>Item</ejb-name>
        </relationship-role-source>
        <cmr-field>
          <cmr-field-name>bids</cmr-field-name>
          <cmr-field-type>java.util.Collection</cmr-field-type>
        </cmr-field>
      </ejb-relationship-role>
      <ejb-relationship-role>
        <ejb-relationship-role-name>many-bids-belong-to-one-item</ejb-relationship-role-name>
        <multiplicity>Many</multiplicity>
        <relationship-role-source>
          <ejb-name>Bid</ejb-name>
        </relationship-role-source>
      </ejb-relationship-role>
    </ejb-relation>
  </relationships>
  <assembly-descriptor>
    <container-transaction>
      <method>
        <ejb-name>Category</ejb-name>
        <method-name>*</method-name>
      </method>
      <trans-attribute>Required</trans-attribute>
    </container-transaction>
    <container-transaction>
      <method>
        <ejb-name>Region</ejb-name>
        <method-name>*</method-name>
      </method>
      <trans-attribute>Required</trans-attribute>
<!--set to required to prevent an error getting tx data map, NPE on region.getId-->
    </container-transaction>
    <container-transaction>
      <method>
        <ejb-name>User</ejb-name>
        <method-name>*</method-name>
      </method>
      <trans-attribute>Required</trans-attribute>
    </container-transaction>
    <container-transaction>
      <method>
        <ejb-name>Item</ejb-name>
        <method-name>*</method-name>
      </method>
      <trans-attribute>Required</trans-attribute>
<!--set to required to prevent an error getting tx data map, NPE-->
    </container-transaction>
    <container-transaction>
      <method>
        <ejb-name>Bid</ejb-name>
        <method-name>*</method-name>
      </method>
      <trans-attribute>required</trans-attribute>
<!--set to required to prevent an error getting tx data map, NPE-->
    </container-transaction>
  </assembly-descriptor>
</ejb-jar>
